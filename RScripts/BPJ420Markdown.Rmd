---
title: "Reproduceable Research"
output:
  pdf_document: default
---
The following document shows how the statistical and graphics program \textit{R} is used to analyse data for this project. Set the working directory to where the output files for \texttt{MyCarrierPlanInterpreter.java} are. These files are available at the github repository for this project. The outputs for \texttt{MyCarrierPlanInterpreter.java} can be found at <https://github.com/fransbrooks/BPJ420FinalYearProject/tree/master/CarrierPlanInterpreter>. For the purposes of this document an analysis of day 3's demand will be shown.  The relevant directories and file names can be changed to analyse the demand for any specific day. The directory specified should contain all the files produced as output for a given day of demand data. This should result in a directory for a given day of demand containing 15 .csv files.
```{r}
setwd("/home/frans/Documents/BPJ420/CarrierPlanInterpreter/Day3")
```
Load the ggplot2 package for plotting data and load the xtable package to generate LaTeX code for tables.
```{r}
library(ggplot2)
library(xtable)
```
#Fleet Composition
##Running-Fixed-Cost and Variable Cost
Read in the .csv file containing data about the fleet composition for running-fixed-cost and variable cost
```{r}
setwd("/home/frans/Documents/BPJ420/CarrierPlanInterpreter/Day3")
FSMinfoRunFixAndVar <- read.csv("Day3_80_vehicleTypesFixedRunningAndVariablesumValues.csv")
FSMinfoRunFixAndVar
```
Make separate tables for each type of truck for running-fixed-cost and variable cost. Do this by subsetting the data read in  above. Subset by searching for a string within the vehId column of the \texttt{FSMinfoRunFixAndVar} data.frame, in order to identify the vehicle type. The string identifying the vehicle type is searched for by making use of the grep function.
```{r}
RunFixAndVarThreeTonners <- FSMinfoRunFixAndVar[grep("truck_3",FSMinfoRunFixAndVar$vehId),]
RunFixAndVarSixTonners <- FSMinfoRunFixAndVar[grep("truck_6",FSMinfoRunFixAndVar$vehId),]
RunFixAndVarSevenTonners <- FSMinfoRunFixAndVar[grep("truck_7",FSMinfoRunFixAndVar$vehId),]
RunFixAndVarTwelveTonners <- FSMinfoRunFixAndVar[grep("truck_12",FSMinfoRunFixAndVar$vehId),]
RunFixAndVarFifteenTonners <- FSMinfoRunFixAndVar[grep("truck_15",FSMinfoRunFixAndVar$vehId),]
RunFixAndVarThreeTonners
```
###Make a data.frame indicating how many vehicles of each type was specified for running-fixed-cost and variable cost.
Make a character vector containing the names of the columns for the data.frame and create an empty data.frame.
```{r}
CollumnNames <- c("3Tonners", "6Tonners", "7Tonners", "12Tonners", "15Tonners")
TruckTotals <- data.frame(matrix(nrow=0, ncol=5))
```
Find the number of rows for each truck type from the data frames by using the length function. This will give the number of trucks for each truck type specified in the fleet composition generated by solving the FSMVRP. Append the number of vehicles specified to the data.frame. 
```{r tidy=TRUE, tidy.opts=list(width.cutoff=40)}
TruckTotals <- rbind(c(length(RunFixAndVarThreeTonners$vehId),length(RunFixAndVarSixTonners$vehId),length(RunFixAndVarSevenTonners$vehId),length(RunFixAndVarTwelveTonners$vehId),length(RunFixAndVarFifteenTonners$vehId)))
```
Assign the column names to the data.frame \texttt{TruckTotals} in order to see how many of each vehicle type was specified in the solution to the FSMVRP. Name the row according to the cost components that were considered in order to generate the fleet composition.
```{r}
colnames(TruckTotals) <- CollumnNames
rownames(TruckTotals) <- "RunFixAndVar"
TruckTotals
```
##Variable Cost 
Read in the .csv file containing data about the fleet composition for variable cost only.
```{r}
setwd("/home/frans/Documents/BPJ420/CarrierPlanInterpreter/Day3")
FSMinfoVar <- read.csv("Day3_80_vehicleTypesOnlyVariablesumValues.csv")
```
Make separate data frames for each type of truck for variable cost only.
```{r}
VarThreeTonners <- FSMinfoVar[grep("truck_3",FSMinfoVar$vehId),]
VarSixTonners <- FSMinfoVar[grep("truck_6",FSMinfoVar$vehId),]
VarSevenTonners <- FSMinfoVar[grep("truck_7",FSMinfoVar$vehId),]
VarTwelveTonners <- FSMinfoVar[grep("truck_12",FSMinfoVar$vehId),]
VarFifteenTonners <- FSMinfoVar[grep("truck_15",FSMinfoVar$vehId),]
```
Append the data for using variable cost only to the \texttt{TruckTotals} data.frame and change the row names to reflect the newly added data.
```{r tidy=TRUE, tidy.opts=list(width.cutoff=40)}
TruckTotals <- rbind(TruckTotals,c(length(VarThreeTonners$vehId),length(VarSixTonners$vehId),length(VarSevenTonners$vehId),length(VarTwelveTonners$vehId),length(VarFifteenTonners$vehId)))
rownames(TruckTotals) <- c("RunFixAndVar","VarOnly")
```
##Running-Fixed-Cost
Read in the .csv file containing data about the fleet composition for running-fixed-cost only.
```{r}
setwd("/home/frans/Documents/BPJ420/CarrierPlanInterpreter/Day3")
FSMinfoRunFix <- read.csv("Day3_80_vehicleTypesOnlyFixedRunningsumValues.csv")
```
Make separate data frames for each type of truck for fixed cost only.
```{r}
RunFixThreeTonners <- FSMinfoRunFix[grep("truck_3",FSMinfoRunFix$vehId),]
RunFixSixTonners <- FSMinfoRunFix[grep("truck_6",FSMinfoRunFix$vehId),]
RunFixSevenTonners <- FSMinfoRunFix[grep("truck_7",FSMinfoRunFix$vehId),]
RunFixTwelveTonners <- FSMinfoRunFix[grep("truck_12",FSMinfoRunFix$vehId),]
RunFixFifteenTonners <- FSMinfoRunFix[grep("truck_15",FSMinfoRunFix$vehId),]
```
Append the data for using variable cost only to the \texttt{TruckTotals} data.frame.
```{r tidy=TRUE, tidy.opts=list(width.cutoff=40)}
TruckTotals <- rbind(TruckTotals,c(length(RunFixThreeTonners$vehId),length(RunFixSixTonners$vehId),length(RunFixSevenTonners$vehId),length(RunFixTwelveTonners$vehId),length(RunFixFifteenTonners$vehId)))
rownames(TruckTotals) <- c("RunFixAndVar","VarOnly","RunFixOnly")
```
##Fixed Cost and Variable Cost
Read in the .csv file containing data about the fleet composition for fixed cost and variable cost.
```{r}
setwd("/home/frans/Documents/BPJ420/CarrierPlanInterpreter/Day3")
FSMinfoFixAndVar <- read.csv("Day3_80_vehicleTypesAbsFixAndVarsumValues.csv")
```
Make separate data frames for each type of truck for fixed and variable cost.
```{r, tidy=TRUE, tidy.opts=list(width.cutoff=50)}
FixAndVarThreeTonners <- FSMinfoFixAndVar[grep("truck_3",FSMinfoFixAndVar$vehId),]
FixAndVarSixTonners <- FSMinfoFixAndVar[grep("truck_6",FSMinfoFixAndVar$vehId),]
FixAndVarSevenTonners <- FSMinfoFixAndVar[grep("truck_7",FSMinfoFixAndVar$vehId),]
FixAndVarTwelveTonners <- FSMinfoFixAndVar[grep("truck_12",FSMinfoFixAndVar$vehId),]
FixAndVarFifteenTonners <- FSMinfoFixAndVar[grep("truck_15",FSMinfoFixAndVar$vehId),]
```
Append the data for using fixed and variable cost to the \texttt{TruckTotals} data.frame.
```{r tidy=TRUE, tidy.opts=list(width.cutoff=40)}
TruckTotals <- rbind(TruckTotals,c(length(FixAndVarThreeTonners$vehId),length(FixAndVarSixTonners$vehId),length(FixAndVarSevenTonners$vehId),length(FixAndVarTwelveTonners$vehId),length(FixAndVarFifteenTonners$vehId)))
rownames(TruckTotals) <- c("RunFixAndVar","VarOnly","RunFixOnly","FixAndVar")
```
##Fixed Cost
Read in the .csv file containing data about the fleet composition for fixed cost only.
```{r}
setwd("/home/frans/Documents/BPJ420/CarrierPlanInterpreter/Day3")
FSMinfoFix <- read.csv("Day3_80_vehicleTypesOnlyAbsFixsumValues.csv")
```
Make separate data frames for each type of truck for fixed cost only.
```{r}
FixThreeTonners <- FSMinfoFix[grep("truck_3",FSMinfoFixAndVar$vehId),]
FixSixTonners <- FSMinfoFix[grep("truck_6",FSMinfoFixAndVar$vehId),]
FixSevenTonners <- FSMinfoFix[grep("truck_7",FSMinfoFixAndVar$vehId),]
FixTwelveTonners <- FSMinfoFix[grep("truck_12",FSMinfoFixAndVar$vehId),]
FixFifteenTonners <- FSMinfoFix[grep("truck_15",FSMinfoFixAndVar$vehId),]
```
Append the data for using fixed cost only to the \texttt{TruckTotals} data.frame
```{r tidy=TRUE, tidy.opts=list(width.cutoff=40)}
TruckTotals <- rbind(TruckTotals,c(length(FixThreeTonners$vehId),length(FixSixTonners$vehId),length(FixSevenTonners$vehId),length(FixTwelveTonners$vehId),length(FixFifteenTonners$vehId)))
rownames(TruckTotals) <- c("Running-Fixed-Cost and Variable Cost","Variable Cost","Running-Fixed-Cost","Fixed and Variable Cost","Fixed Cost")
```
##Finalise the \texttt{TruckTotals} data.frame
Add a new column which shows total number of vehicles for each cost scenario by using the rowSums function. Append the new column to the \texttt{TruckTotals} data.frame by using the cbind function. The \texttt{TruckTotals} data.frame now shows the fleet composition sing each set of cost parameters for day 3's demand data.
```{r tidy=TRUE, tidy.opts=list(width.cutoff=40)}
TruckTotals <- cbind(TruckTotals, rowSums(TruckTotals))
CollumnNames <- c("3Tonners", "6Tonners", "7Tonners", "12Tonners", "15Tonners", "Total")
colnames(TruckTotals) <- CollumnNames
TruckTotals
```

##Generate \LaTeX  Code for Fleet Compositions
Use the xtable package to generate a table in \LaTeX  code for use in \LaTeX documents.
```{r}
xtable(TruckTotals)
```
#Fleet compositions plot
Change the \texttt{TruckTotals} data.frame into the 'long format' using the \texttt{melt} from the reshape2 package. This makes it possible to plot the fleet compositions for all the costs in one plot by means of stacked bars. The \texttt{Totals} column must be removed from \texttt{TruckTotals}, becuase the total size of the fleet will be represented by the stacked bar. Spaces in the column names are also removed, so the columns can be reffered to in the ggplot function. Referring to column names with spaces in the ggplot function generates an error.
```{r tidy=TRUE, tidy.opts=list(width.cutoff=80)}
TruckTotals <- TruckTotals[,-6] #Remove the "Totals" column
library(reshape2)
m.TruckTotals <- melt(TruckTotals)
colnames(m.TruckTotals) <- c("CostParameters","VehicleType","NumOfVehicles")
StackPlot <- ggplot(data=m.TruckTotals, aes(x=CostParameters,y=NumOfVehicles,fill=VehicleType)) + geom_bar(stat='identity', width=.5)
StackPlot <- StackPlot + coord_flip() + xlab("Cost considered in optimization") + ylab("Number of trucks") + scale_fill_brewer(palette = "Set1")
StackPlot <- StackPlot + theme_bw() + ggtitle("Fleet composition, day 3")
StackPlot
```

#Distance travelled plot
Add a column called "Cost" to each data.frame which contains the information for each model run. Add a variable to each row of the \texttt{Cost} column which describes the cost components considered in the model. Because the cost components used is the same for each data.frame, each row can be assigned the same value for the \texttt{Cost} variable. Create a new data.frame, \texttt{FSMinfo}. This data.frame will be appended with all the data from each model run, so the distance information can be plotted in a single plot. 
```{r tidy=TRUE, tidy.opts=list(width.cutoff=40)}
FSMinfoFix["Cost"] <- "Fixed cost"
FSMinfoFixAndVar["Cost"] <- "Fixed and variable cost"
FSMinfoRunFix["Cost"] <- "Running-fixed-cost"
FSMinfoRunFixAndVar["Cost"] <- "Running-fixed-cost and variable cost"
FSMinfoVar["Cost"] <- "Variable cost"
FSMinfo <- data.frame()
FSMinfo <- rbind(FSMinfoFix,FSMinfoFixAndVar,FSMinfoRunFix,FSMinfoRunFixAndVar,FSMinfoVar)
colnames(FSMinfo) <- c("VehicleID", "NumOfActivities","TotalDistKM", "TotalTravelTimeHours","Cost")
FSMinfo$VehicleID <- factor(x = FSMinfo$VehicleID, c("truck_3_1","truck_3_1_0", "truck_3_1_1", "truck_6_1", "truck_6_1_0",  "truck_12_1", "truck_15_1", "truck_15_1_0", "truck_15_1_1"))
FSMinfo$TotalDistKM <- round(FSMinfo$TotalDistKM,0)
DistanceStackPlot <- ggplot(data=FSMinfo, aes(x=Cost,y=TotalDistKM,fill=VehicleID)) + geom_bar(stat='identity', width=.5)
DistanceStackPlot <- DistanceStackPlot + scale_fill_brewer(palette = "Set1") + xlab("Cost considered in optimization") + ylab("Distance travelled (km)")
DistanceStackPlot <- DistanceStackPlot + theme_bw() + ggtitle("Distance travelled, day 3") + geom_text(aes(label =TotalDistKM), position = "stack", hjust = 0.5, vjust = 1.1)
DistanceStackPlot <- DistanceStackPlot + scale_x_discrete(labels = c("Fixed and variable cost" = "Fixed and \nvariable cost", "Running-fixed-cost and variable cost" = "Running-fixed- \ncost and \nvariable cost", "Running-fixed-cost" = "Running-fixed- \ncost"))
DistanceStackPlot
```

The code used to generate this .pdf plot for the project's final document is identical, but for an unknown reason the plot does not display correctly in this .pdf document, which is generated by 'knitting' this R Markdown document to a .pdf file.